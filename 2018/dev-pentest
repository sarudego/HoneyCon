Taller Pentest

Nacho github.com/n4xh4ck5
(Master UNED)

Alvaro github.com/naivenom

1parte: Pentesting
sabiendo solo el nombre de empresa, se analizan servicios, datos, formas de atacar... desde analisis hasta explotacion de vulnerabilidades

Escenario - Realizar un pentesting dentro de un servicio de Red Team
Reconocimiento de informacion:
-Dos fases:
--Footprinting, forma pasiva (OSINT) https://inteltechniques.com/menu.html
	DOMINIOS:	
	Robtex
	Reverse Report
	https://www.threatcrowd.org/
	ipv4info.com
	
	Whois, geolocalizacion archivos...:
	domaintools.com
	db-ip.com
	linkedin (inSpy(recomendable), linkedin2username, scapedin(no estable aun))
		vishing(llamar por telefono haciendote pasar por otro, RRHH no recomendable, 			marketing o comerciales)
	 
	Hacking con buscadores:
	google (exploit-db.com/google-hacking-database)
		site:*.vodafone.es OR site:*.vodafone.es -site:www.vodafone.es
		ip (bing) - lista dominios de una ip
			ip: 212.166.190.52 (vodafone)
		domain (bing)
	
		ext:pdf intitle: "c documents and settings"
		"tu contrasenya inicial"
		"your initial password"
		"your password is the same"
		"allinurl:com:8080"		


	bing
	baidu
	yandex
	yaci
	duckduckgo
	exalead(metadatos)

	puertos y servicios:
	shodan (API free y premium, recomendada y vitalicia)
		images.shodan.io
		shiptracker
	
	censys
	servicios para analisis de servicios:
		wh01p github.com/n4xh4ck5/wh01p
		sh4d0m
		github -> N4xDOrk, V1DOm, crOwd, t1pfO
		reversedns
	
	Metadatos:
		Busqueda y extraccion
			Foca
			Metagoofil
			RastLeak
			PoweMeta
		Extraccion:
			Exitfool
	
	Repositorios:
		gitminer

	He sido juankeado?
		infoga
		the harvester
		have i been pwned
		hacked-emails
		isleader
		breachalarm.com





--Fingerprinting, forma activa
Se obtiene un mapa de red y visibilidad para la superficie de ataque
Que se busca?
-Identificar IPS
-Dominios
-Subdominios
-Puertos y servicios
-Tecnologia usada
-Resultados indexados
-Rutas por defecto, usuarios...


	escaner de red:
		nmap
			nmap -sSV -A -open -v -oN RESULTADOS
		fichero robots.txt

	identificar tecnologia:
		cabecera respuesta: "server", "X-powered-by"
		nombre cookie: PHPSessionID
		forzar error
		analizar codigo fuente
		telnet
	fuzzing - enumerar directorios
		seclists (github.com/danielmiessier/SecLists
			raft large *)
		fuzzDB
		dirB
		BurpPro
		Dirhunt
		photon
	CMS
		CMSsc4n

	Nikto
		seguridad en cabeceras
		lsitado de directorios

	interfaz de administracion
		panel de admin:
			github webappdefaultsdb
			seclists
		usuarios 
		tutoriales y manuales
	vectores de compromiso:
		inyeccion codigo SQLi o JavaScript
			XSS -> github sOmd3v/Striker
		Bypass login mediante SQLi o modificar cabeceras (location)
		incorrectos controles autorizacion
		identificar subida ficheros
			github almandin/fuxploider
			web.config en asp, web shell
	herramienta Od1n(del ponente)
		automatizar el proceso de visilibidad de target
		puerto 445 - SMB, vulnerable

Explotacion:
	Enumerar red interna:
		Sniffer de red (wireshark)
		escaneo y enumeracion de red
			bbdd, servidor aplicaciones, SSOO, servicios y puertos...
			ls /usr/share/nmap/scripts/smb*
			windows 7 / windows XP, server 2003/2005
			puertos 22, 445, 3389(RDP)
		sniffer de passwords, token, usuarios
		default passwd
		explotacion de servicio -> subida webshell -> admin? -> creacion user admin -> no admin? - escalar privilegios
		hackthebox(jerry, tomcat/tomcat, admin/admin...)
		casos de uso: 
			apache tomcat
			Netapi
			EternalBlue




-------------------------
acceder a administracion de tomcat
crear un fichero war para obtener reverse shell (desde github seclist, jsp)
subir el fichero war
---otra forma...
usar metasploit (mfsconsole, meterpreter)

-------------------------


	postexplotacion windows:
		obtener hash: hashdump, cachedump
		escalar privilegios vuln: windows-suggester
		crack hash: john, hashcat
		pass the hass
			buscar identificador usuario 512(es el domain admin)
			solo funciona hasta windows server 2012
		busqueda info sensible
		buscar maquinas de domain



-------------------------
john the ripper
LM son faciles
usar rockyou para provocar colisiones contra hashes

john --format=NT hashes.txt /usr/share/wordlist/rockyou.txt
-------------------------

	postexplotacion linux:
		identificar software vulnerable: kernel...
		revisar tareas periodidas, permisos, puertos, cron...
		


-------------------------
hackthebox
maquina strathosphere
nmap(3 puertos, web y remoto)
accedemos con burpsuite por debajo
hacer web crawler
lanzar fuzzing
lanzar diccionario dirbaster
ficheros .action?? por debajo tiene apache strut, tiene vulnerabilidades recientes, explotables con struts pwn


-------------------------



2parte: Reversing RadarECON (Alvaro) (OSCP) (OSCM?)
Ensamblador, python







